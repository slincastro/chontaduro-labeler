<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Refactorial</title>
    <!-- Font Awesome CDN (gratuito) -->
    <script src="https://kit.fontawesome.com/6a2b987c6b.js" crossorigin="anonymous"></script>
    <style>
      .language-info {
        display: flex;
        align-items: center;
        margin-bottom: 1em;
        padding: 0.5em;
        border-radius: 8px;
        color: white;
      }
      
      .language-icon {
        font-size: 1.5em;
        margin-right: 0.5em;
      }
      
      .language-name {
        font-weight: bold;
        font-size: 1.2em;
      }
      
      .language-subtitle {
        font-size: 0.9em;
      }
      
      .nav-buttons {
        margin-top: 1.5em;
        display: flex;
        gap: 1em;
        justify-content: center;
      }

      .nav-buttons button {
        background-color: #2c3e50;
        color: white;
        border: none;
        padding: 0.75em 1.5em;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5em;
        transition: background-color 0.3s ease;
      }

      .nav-buttons button:hover {
        background-color: #34495e;
      }

      .nav-buttons button:active {
        transform: scale(0.98);
      }

      .nav-buttons i {
        font-size: 1.2em;
      }
    </style>
  </head>

  <body style="font-family: sans-serif; padding: 1em;">
    <!-- Language info section -->
    <div id="languageInfoContainer" class="language-info">
      <i id="languageIconElement" class="language-icon"></i>
      <div>
        <div id="languageNameElement" class="language-name"></div>
        <div class="language-subtitle">Analyzing code metrics</div>
      </div>
    </div>
    
    <div class="nav-buttons">
      <button onclick="navigate('prev')">
        <i class="fas fa-backward"></i> <span>Anterior</span>
      </button>
      <button onclick="navigate('next')">
        <i class="fas fa-forward"></i> <span>Siguiente</span>
      </button>
    </div>

    <h3>Analizando ${title}</h3>

    <div style="padding: 8px; border-radius: 4px; margin-bottom: 10px; display: flex; align-items: center;">
      <strong>Archivos procesados:</strong> ${processedFilesCount}
      <button onclick="openCsvFile()" style="margin-left: 10px; background: none; border: none; cursor: pointer; color: #0078d7; display: flex; align-items: center; padding: 2px 5px; border-radius: 4px; font-size: 0.9em;" title="Abrir archivo CSV">
        <i class="fas fa-file-csv" style="margin-right: 4px;"></i>
        <span>Abrir CSV</span>
      </button>
    </div>

    <p>${content}</p>

    <div style="margin-top: 1em; display: flex; align-items: center;">
      <input type="checkbox" id="refactoringCheckbox" onchange="toggleRefactoring(this.checked)">
      <label for="refactoringCheckbox" style="margin-left: 0.5em;">Debe refactorizarse</label>
    </div>

    <p style="color: #888; margin-top: 2em;">Powered by ReFactorial !!</p>

    <script>
      const vscode = acquireVsCodeApi();

      // Set language information
      function setLanguageInfo(name, icon, color) {
        console.log(`Setting language info: ${name}, ${icon}, ${color}`);
        
        const container = document.getElementById('languageInfoContainer');
        const iconElement = document.getElementById('languageIconElement');
        const nameElement = document.getElementById('languageNameElement');
        
        if (!container || !iconElement || !nameElement) {
          console.error('Could not find language info elements');
          return;
        }
        
        // Set background color
        container.style.backgroundColor = color;
        
        // Set icon class
        iconElement.className = icon + ' language-icon';
        
        // Set language name
        nameElement.textContent = name;
        
        console.log('Language info set successfully');
      }

      function navigate(direction) {
        vscode.postMessage({ command: 'navigate', direction });
      }

      function toggleRefactoring(checked) {
        vscode.postMessage({
          command: 'toggleRefactoring',
          checked: checked
        });
      }
      
      function openCsvFile() {
        vscode.postMessage({
          command: 'openCsvFile'
        });
      }

      window.addEventListener('message', event => {
        console.log('Message received:', event.data);
        const message = event.data;
        
        if (message.command === 'resetRefactoringCheckbox') {
          console.log('Resetting refactoring checkbox');
          document.getElementById('refactoringCheckbox').checked = false;
        } else if (message.command === 'setLanguageInfo') {
          console.log('Setting language info from message');
          setLanguageInfo(message.name, message.icon, message.color);
        } else {
          console.log('Unknown command:', message.command);
        }
      });
      
      console.log('Webview script loaded and ready');

      // Initialize with default values
      setLanguageInfo('Loading...', 'fas fa-code', '#808080');
      
      // Send ready message to extension
      setTimeout(() => {
        console.log('Sending ready message to extension');
        vscode.postMessage({ command: 'webviewReady' });
      }, 100);
    </script>
  </body>
</html>
